---
name: 详情页面开发
status: open
created: 2025-09-09T09:19:22Z
updated: 2025-09-09T09:19:22Z
github: placeholder
depends_on: [016, 017]
parallel: true
conflicts_with: []
---

# 详情页面开发

## Description
开发运动记录详情页面，完整展示单条运动记录的所有信息。包含运动数据展示、图片展示、位置信息、分享功能、编辑删除等操作。提供丰富的交互功能和良好的视觉体验，支持分享图片查看、地图展示、数据编辑等功能。

## Acceptance Criteria
- [ ] 详情页面UI设计实现，展示完整的运动记录信息
- [ ] 运动数据可视化展示，包含图表和数据卡片
- [ ] 图片展示功能，支持多图浏览和缩放查看
- [ ] 位置信息展示，集成地图显示运动地点
- [ ] 分享功能集成，支持生成分享图片和社交分享
- [ ] 编辑功能实现，支持修改运动记录信息
- [ ] 删除功能实现，包含确认对话框
- [ ] 页面导航和返回功能，良好的页面流转体验
- [ ] 加载状态管理，数据加载过程的友好提示
- [ ] 错误处理机制，网络异常时的处理策略
- [ ] 响应式设计，适配不同屏幕尺寸
- [ ] 数据同步机制，编辑后的数据更新

## Technical Details
### 详情页面组件结构
```typescript
// 详情页面属性接口
interface RecordDetailPageProps {
  recordId: string;
  onEdit?: (record: SportRecord) => void;
  onDelete?: (recordId: string) => void;
  onShare?: (record: SportRecord) => void;
}

// 详情页面状态接口
interface RecordDetailPageState {
  record: SportRecord | null;
  loading: boolean;
  error: string | null;
  currentImageIndex: number;
  showImageViewer: boolean;
  showMap: boolean;
  showEditModal: boolean;
  showDeleteConfirm: boolean;
  isSharing: boolean;
}

// 详情数据展示组件
const RecordDetailView: React.FC<{ record: SportRecord }> = ({ record }) => {
  const sportTypeConfig = getSportTypeConfig(record.sportType);
  
  return (
    <View className="record-detail-container">
      {/* 头部信息 */}
      <View className="detail-header">
        <View className="sport-type-badge">
          <Icon type={sportTypeConfig.icon} size="large" />
          <Text className="sport-type-name">{sportTypeConfig.name}</Text>
        </View>
        <Text className="record-time">{formatDateTime(record.createdAt)}</Text>
      </View>

      {/* 运动数据卡片 */}
      <View className="data-cards-container">
        <DataCard 
          title="运动时长"
          value={`${record.data.duration}分钟`}
          icon="time"
          color="#1890ff"
        />
        {record.data.distance && (
          <DataCard 
            title="运动距离"
            value={`${record.data.distance}公里`}
            icon="location"
            color="#52c41a"
          />
        )}
        <DataCard 
          title="消耗卡路里"
          value={`${record.data.calories}卡`}
          icon="fire"
          color="#fa8c16"
        />
        {record.data.heartRate && (
          <DataCard 
            title="平均心率"
            value={`${record.data.heartRate}次/分`}
            icon="heart"
            color="#f5222d"
          />
        )}
        {record.data.steps && (
          <DataCard 
            title="步数"
            value={`${record.data.steps}步`}
            icon="footprint"
            color="#722ed1"
          />
        )}
      </View>

      {/* 描述信息 */}
      {record.description && (
        <View className="description-section">
          <Text className="section-title">运动描述</Text>
          <Text className="description-text">{record.description}</Text>
        </View>
      )}

      {/* 图片展示 */}
      {record.images.length > 0 && (
        <View className="images-section">
          <Text className="section-title">运动照片</Text>
          <ImageGallery 
            images={record.images}
            onImageClick={(index) => this.showImageViewer(index)}
          />
        </View>
      )}

      {/* 位置信息 */}
      {record.location && (
        <View className="location-section">
          <Text className="section-title">运动地点</Text>
          <View className="location-info">
            <Icon type="location-fill" size="small" />
            <Text className="location-address">{record.location.address}</Text>
          </View>
          <MapView 
            latitude={record.location.latitude}
            longitude={record.location.longitude}
            markers={[{...record.location, title: '运动地点'}]}
            className="location-map"
          />
        </View>
      )}
    </View>
  );
};
```

### 图片查看器组件
```typescript
// 图片查看器组件
interface ImageViewerProps {
  images: string[];
  currentIndex: number;
  visible: boolean;
  onClose: () => void;
  onIndexChange?: (index: number) => void;
}

const ImageViewer: React.FC<ImageViewerProps> = ({ 
  images, 
  currentIndex, 
  visible, 
  onClose, 
  onIndexChange 
}) => {
  const [scale, setScale] = useState(1);
  const [position, setPosition] = useState({ x: 0, y: 0 });
  const [isZooming, setIsZooming] = useState(false);

  // 手势处理
  const handleTouchStart = (event: ITouchEvent) => {
    if (event.touches.length === 2) {
      setIsZooming(true);
    }
  };

  const handleTouchMove = (event: ITouchEvent) => {
    if (isZooming && event.touches.length === 2) {
      const touch1 = event.touches[0];
      const touch2 = event.touches[1];
      
      // 计算两点间距离
      const distance = Math.sqrt(
        Math.pow(touch2.x - touch1.x, 2) + Math.pow(touch2.y - touch1.y, 2)
      );
      
      // 基于距离计算缩放比例
      const newScale = Math.min(Math.max(1, distance / 100), 3);
      setScale(newScale);
    }
  };

  const handleTouchEnd = () => {
    setIsZooming(false);
  };

  // 图片切换
  const handleSwipe = (direction: 'left' | 'right') => {
    if (direction === 'left' && currentIndex < images.length - 1) {
      const newIndex = currentIndex + 1;
      onIndexChange?.(newIndex);
      setScale(1); // 重置缩放
      setPosition({ x: 0, y: 0 });
    } else if (direction === 'right' && currentIndex > 0) {
      const newIndex = currentIndex - 1;
      onIndexChange?.(newIndex);
      setScale(1); // 重置缩放
      setPosition({ x: 0, y: 0 });
    }
  };

  if (!visible) return null;

  return (
    <View className="image-viewer-overlay" onClick={onClose}>
      <View 
        className="image-viewer-container"
        onTouchStart={handleTouchStart}
        onTouchMove={handleTouchMove}
        onTouchEnd={handleTouchEnd}
        onClick={(e) => e.stopPropagation()}
      >
        <Image
          className="viewer-image"
          src={images[currentIndex]}
          mode="aspectFit"
          style={{
            transform: `scale(${scale}) translate(${position.x}px, ${position.y}px)`
          }}
        />
        
        {/* 图片指示器 */}
        {images.length > 1 && (
          <View className="image-indicator">
            <Text className="indicator-text">{currentIndex + 1} / {images.length}</Text>
          </View>
        )}
        
        {/* 关闭按钮 */}
        <View className="viewer-close" onClick={onClose}>
          <Icon type="close" size="large" />
        </View>
        
        {/* 导航按钮 */}
        {currentIndex > 0 && (
          <View className="viewer-nav prev" onClick={() => handleSwipe('right')}>
            <Icon type="left" size="large" />
          </View>
        )}
        {currentIndex < images.length - 1 && (
          <View className="viewer-nav next" onClick={() => handleSwipe('left')}>
            <Icon type="right" size="large" />
          </View>
        )}
      </View>
    </View>
  );
};
```

### 编辑功能实现
```typescript
// 记录编辑管理器
class RecordEditManager {
  private originalRecord: SportRecord | null = null;
  private editedData: Partial<SportRecord> = {};

  // 开始编辑
  startEdit(record: SportRecord): void {
    this.originalRecord = { ...record };
    this.editedData = {};
  }

  // 更新字段
  updateField(field: keyof SportRecord, value: any): void {
    if (!this.originalRecord) return;
    
    this.editedData[field] = value;
  }

  // 验证编辑数据
  validateEdit(): ValidationResult {
    const errors: string[] = [];
    
    // 验证运动类型
    if (this.editedData.sportType && !SPORT_TYPES.includes(this.editedData.sportType)) {
      errors.push('无效的运动类型');
    }
    
    // 验证运动数据
    if (this.editedData.data) {
      const data = this.editedData.data;
      
      if (data.duration && (data.duration < 1 || data.duration > 1440)) {
        errors.push('运动时长必须在1-1440分钟之间');
      }
      
      if (data.calories && (data.calories < 10 || data.calories > 5000)) {
        errors.push('卡路里必须在10-5000之间');
      }
      
      if (data.distance && (data.distance < 0 || data.distance > 100)) {
        errors.push('距离必须在0-100公里之间');
      }
    }
    
    // 验证描述长度
    if (this.editedData.description && this.editedData.description.length > 500) {
      errors.push('描述不能超过500个字符');
    }
    
    return {
      isValid: errors.length === 0,
      errors
    };
  }

  // 保存编辑
  async saveEdit(): Promise<SaveResult> {
    if (!this.originalRecord) {
      throw new Error('没有正在编辑的记录');
    }
    
    // 验证编辑数据
    const validation = this.validateEdit();
    if (!validation.isValid) {
      return {
        success: false,
        errors: validation.errors
      };
    }
    
    try {
      // 合并编辑数据
      const updatedRecord = {
        ...this.originalRecord,
        ...this.editedData,
        updatedAt: new Date()
      };
      
      // 调用API保存
      const result = await this.updateRecord(updatedRecord);
      
      // 清空编辑状态
      this.originalRecord = null;
      this.editedData = {};
      
      return {
        success: true,
        data: result
      };
      
    } catch (error) {
      return {
        success: false,
        errors: [error.message || '保存失败']
      };
    }
  }

  // 取消编辑
  cancelEdit(): void {
    this.originalRecord = null;
    this.editedData = {};
  }

  // 获取编辑状态
  getEditStatus(): EditStatus {
    if (!this.originalRecord) {
      return { isEditing: false };
    }
    
    const hasChanges = Object.keys(this.editedData).length > 0;
    
    return {
      isEditing: true,
      hasChanges,
      changedFields: Object.keys(this.editedData),
      originalRecord: this.originalRecord,
      editedData: this.editedData
    };
  }

  private async updateRecord(record: SportRecord): Promise<any> {
    return await cloud.callFunction({
      name: 'updateSportRecord',
      data: {
        recordId: record._id,
        updateData: this.editedData
      }
    });
  }
}

interface ValidationResult {
  isValid: boolean;
  errors: string[];
}

interface SaveResult {
  success: boolean;
  data?: any;
  errors?: string[];
}

interface EditStatus {
  isEditing: boolean;
  hasChanges?: boolean;
  changedFields?: string[];
  originalRecord?: SportRecord;
  editedData?: Partial<SportRecord>;
}
```

## Dependencies
- 依赖任务016（记录列表展示）提供基础列表功能
- 依赖任务017（分页加载优化）提供数据加载支持

## Effort Estimate
- **Size**: L (大)
- **Estimated Hours**: 16-20 小时

## Definition of Done
- [ ] 详情页面UI完整实现，展示所有运动记录信息
- [ ] 运动数据可视化展示，数据卡片和图表实现
- [ ] 图片查看器功能完成，支持缩放、滑动、手势操作
- [ ] 地图集成功能实现，正确显示运动位置信息
- [ ] 分享功能集成完成，支持生成分享图片和社交分享
- [ ] 编辑功能完整实现，支持修改所有记录字段
- [ ] 删除功能实现完成，包含确认和撤销机制
- [ ] 页面导航和状态管理，良好的页面流转体验
- [ ] 加载和错误处理，各种状态的友好提示
- [ ] 响应式设计完成，在不同设备上都有良好表现
- [ ] 数据同步机制实现，编辑后的实时更新
- [ ] 性能优化完成，页面加载和交互响应迅速
- [ ] 跨平台兼容性测试通过，微信小程序和H5功能一致
- [ ] 单元测试覆盖率达到85%以上，核心功能充分测试
- [ ] 用户体验优化完成，交互流畅，反馈及时
- [ ] 代码审查通过，符合项目编码规范和最佳实践
- [ ] 文档编写完成，包含使用说明和API文档

## Performance Requirements
- 页面加载时间：< 1.5秒（包含图片和数据）
- 图片查看器响应：< 300ms（切换和缩放）
- 编辑操作响应：< 500ms（本地验证）
- 地图加载时间：< 2秒（首次加载）
- 分享生成时间：< 3秒（图片生成）

## Security and Privacy
- 数据访问权限验证，确保用户只能操作自己的记录
- 图片查看安全控制，防止恶意图片访问
- 编辑权限验证，防止越权操作
- 数据删除安全处理，确保彻底删除

## Monitoring and Maintenance
- 详情页面访问统计
- 功能使用率分析
- 性能指标监控
- 错误日志收集和分析
- 用户行为路径追踪

## Future Enhancements
- 运动轨迹展示
- 数据分析图表
- 语音描述功能
- 视频记录支持
- 多人协作编辑
- 版本历史管理
- 智能数据分析
- 健康建议生成

## Analytics Best Practices
- 建立详情页面使用指标体系
- 分析用户查看行为模式
- 监控功能使用频率
- 优化页面布局和交互
- 持续改进用户体验

## Compliance and Governance
- 数据展示合规性检查
- 用户隐私保护验证
- 内容审核机制集成
- 定期安全评估
- 建立数据治理流程

## Documentation and Training
- 编写详情页面使用手册
- 提供功能操作指南
- 制作交互演示视频
- 建立最佳实践库
- 开展用户培训和支持

## Performance Optimization
- 图片懒加载和预加载策略
- 数据分页和缓存机制
- 组件渲染优化
- 内存使用监控
- 网络请求优化

## Accessibility
- 支持屏幕阅读器
- 键盘导航支持
- 高对比度模式
- 字体大小调节
- 色盲友好设计

## Internationalization
- 多语言支持框架
- 本地化数据处理
- 时区适配
- 货币单位转换
- 日期格式本地化

## Testing Strategy
- 功能测试覆盖所有交互
- 兼容性测试多平台
- 性能测试压力测试
- 安全测试漏洞扫描
- 用户体验测试验证

## Deployment Considerations
- 版本兼容性处理
- 数据迁移策略
- 灰度发布方案
- 回滚机制准备
- 监控告警配置

## Risk Assessment
- 数据丢失风险
- 性能瓶颈风险
- 兼容性问题风险
- 安全漏洞风险
- 用户体验风险

## Success Metrics
- 页面访问转化率
- 功能使用满意度
- 性能指标达成率
- 错误率控制
- 用户留存提升

## Maintenance Plan
- 定期功能更新
- 性能持续优化
- 安全漏洞修复
- 用户反馈处理
- 数据分析改进

## Technical Debt Management
- 代码重构计划
- 依赖更新策略
- 性能优化迭代
- 架构演进规划
- 技术栈升级路径

## Knowledge Transfer
- 技术文档整理
- 代码注释完善
- 架构设计说明
- 最佳实践总结
- 问题解决方案

## Continuous Improvement
- 用户反馈收集
- 数据分析驱动
- A/B测试验证
- 迭代优化计划
- 创新功能探索

## Team Collaboration
- 开发流程规范
- 代码审查标准
- 测试质量保证
- 发布管理流程
- 运维支持机制

## Stakeholder Communication
- 项目进度汇报
- 风险问题沟通
- 成果展示演示
- 用户培训支持
- 商业价值体现

## Quality Assurance
- 代码质量检查
- 功能完整性验证
- 性能基准测试
- 安全漏洞扫描
- 用户体验评估

## Innovation Opportunities
- AI智能分析集成
- 社交功能扩展
- 健康生态系统
- 商业模式创新
- 技术前沿应用

## Scalability Considerations
- 架构扩展性设计
- 数据量增长应对
- 用户规模扩展
- 功能模块扩展
- 性能横向扩展

## Business Value
- 用户粘性提升
- 功能价值体现
- 数据资产积累
- 品牌影响力增强
- 商业变现支持

## Competitive Analysis
- 竞品功能对比
- 用户体验优势
- 技术创新亮点
- 市场定位分析
- 差异化竞争策略

## Roadmap Alignment
- 产品战略规划
- 技术发展路线
- 市场需求匹配
- 资源配置优化
- 里程碑达成

## Resource Requirements
- 开发人力投入
- 设计资源支持
- 测试环境配置
- 运维服务保障
- 预算成本控制

## Timeline Management
- 开发周期规划
- 里程碑设置
- 风险缓冲预留
- 质量保证时间
- 发布窗口安排

## Communication Plan
- 团队内部沟通
- 跨部门协作
- 上级汇报机制
- 用户反馈渠道
- 外部合作沟通

## Risk Mitigation
- 技术风险预案
- 进度风险应对
- 质量风险控制
- 资源风险保障
- 外部风险缓冲

## Success Factors
- 技术实现质量
- 用户体验满意度
- 功能完整性
- 性能稳定性
- 商业价值实现

## Lessons Learned
- 开发经验总结
- 技术难点攻克
- 团队协作优化
- 流程改进建议
- 知识积累沉淀

## Future Considerations
- 技术发展趋势
- 市场需求变化
- 用户行为演进
- 竞争环境分析
- 战略规划调整

## Conclusion
运动记录详情页面是整个应用的核心功能之一，需要综合考虑用户体验、性能优化、安全合规等多个方面。通过精心设计和实现，为用户提供丰富、流畅、安全的记录查看和管理体验，同时为后续的功能扩展和商业化运营奠定坚实基础。
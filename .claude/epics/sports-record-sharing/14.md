---
name: åˆ†äº«æ¨¡æ¿è®¾è®¡
status: open
created: 2025-09-09T09:19:22Z
updated: 2025-09-10T06:15:48Z
github: https://github.com/terry237tm/sports-record-sharing-app/issues/14
depends_on: [011]
parallel: false
conflicts_with: []
---

# åˆ†äº«æ¨¡æ¿è®¾è®¡

## Description
è®¾è®¡å¤šç§ç²¾ç¾çš„è¿åŠ¨è®°å½•åˆ†äº«æ¨¡æ¿ï¼Œæä¾›ä¸åŒé£æ ¼å’Œåœºæ™¯çš„å›¾ç‰‡æ¨¡æ¿é€‰æ‹©ã€‚åŒ…æ‹¬æ¨¡æ¿é…ç½®ç³»ç»Ÿã€æ ·å¼å‚æ•°åŒ–ã€ä¸»é¢˜è‰²å½©ç®¡ç†ã€å­—ä½“å›¾æ ‡ç³»ç»Ÿç­‰ï¼Œç¡®ä¿ç”Ÿæˆçš„åˆ†äº«å›¾ç‰‡å…·æœ‰ä¸“ä¸šçš„è®¾è®¡æ„Ÿå’Œä¸ªæ€§åŒ–ç‰¹è‰²ã€‚

## Acceptance Criteria
- [ ] æ¨¡æ¿é…ç½®ç³»ç»Ÿè®¾è®¡å®Œæˆï¼Œæ”¯æŒJSONæ ¼å¼æ¨¡æ¿å®šä¹‰
- [ ] å¤šç§é¢„è®¾æ¨¡æ¿å®ç°ï¼ŒåŒ…å«ç®€çº¦ã€è¿åŠ¨ã€å•†åŠ¡ã€å¯çˆ±ç­‰é£æ ¼
- [ ] ä¸»é¢˜è‰²å½©ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒè‡ªå®šä¹‰é…è‰²æ–¹æ¡ˆ
- [ ] å­—ä½“å’Œå›¾æ ‡ç³»ç»Ÿé›†æˆï¼Œæ”¯æŒå¤šç§å­—ä½“å’Œå›¾æ ‡åº“
- [ ] æ¨¡æ¿å‚æ•°åŒ–é…ç½®ï¼Œæ”¯æŒåŠ¨æ€å†…å®¹æ›¿æ¢
- [ ] å“åº”å¼å¸ƒå±€é€‚é…ï¼Œæ”¯æŒä¸åŒå°ºå¯¸æ¯”ä¾‹çš„åˆ†äº«å›¾ç‰‡
- [ ] æ¨¡æ¿é¢„è§ˆåŠŸèƒ½ï¼Œå®æ—¶é¢„è§ˆæ¨¡æ¿æ•ˆæœ
- [ ] ç”¨æˆ·è‡ªå®šä¹‰æ¨¡æ¿åŠŸèƒ½ï¼Œæ”¯æŒä¿å­˜ä¸ªäººæ¨¡æ¿é…ç½®
- [ ] æ¨¡æ¿ç¼“å­˜æœºåˆ¶ï¼Œæé«˜æ¨¡æ¿åŠ è½½æ€§èƒ½
- [ ] A/Bæµ‹è¯•æ”¯æŒï¼Œæ”¯æŒä¸åŒæ¨¡æ¿çš„æ•ˆæœå¯¹æ¯”

## Technical Details
### æ¨¡æ¿é…ç½®æ¶æ„
```typescript
// æ¨¡æ¿é…ç½®æ¥å£
interface ShareTemplate {
  id: string;
  name: string;
  description: string;
  category: 'minimal' | 'sport' | 'business' | 'cute' | 'custom';
  version: string;
  createdAt: Date;
  updatedAt: Date;
  
  // å¸ƒå±€é…ç½®
  layout: {
    width: number;
    height: number;
    background: BackgroundConfig;
    elements: ElementConfig[];
  };
  
  // æ ·å¼é…ç½®
  styles: {
    colors: ColorScheme;
    typography: TypographyConfig;
    spacing: SpacingConfig;
    effects: EffectConfig;
  };
  
  // æ•°æ®ç»‘å®š
  dataBindings: DataBindingConfig[];
}

// èƒŒæ™¯é…ç½®
interface BackgroundConfig {
  type: 'color' | 'gradient' | 'image' | 'pattern';
  value: string | GradientConfig | ImageConfig;
  opacity?: number;
  overlay?: OverlayConfig;
}

// å…ƒç´ é…ç½®
interface ElementConfig {
  id: string;
  type: 'text' | 'image' | 'shape' | 'icon';
  position: PositionConfig;
  size: SizeConfig;
  style: ElementStyleConfig;
  dataBinding?: string;
  conditions?: ConditionConfig[];
}
```

### é¢„è®¾æ¨¡æ¿å®ç°
```typescript
// ç®€çº¦é£æ ¼æ¨¡æ¿
const minimalTemplate: ShareTemplate = {
  id: 'minimal-001',
  name: 'ç®€çº¦ç™½',
  description: 'ç®€æ´å¤§æ°”çš„ç™½è‰²ä¸»é¢˜æ¨¡æ¿',
  category: 'minimal',
  version: '1.0.0',
  
  layout: {
    width: 750,
    height: 1334,
    background: {
      type: 'color',
      value: '#ffffff'
    },
    elements: [
      {
        id: 'user-info',
        type: 'text',
        position: { x: 60, y: 120 },
        size: { width: 630, height: 80 },
        style: {
          fontFamily: 'PingFang SC',
          fontSize: 32,
          color: '#333333',
          textAlign: 'left',
          fontWeight: 'normal'
        },
        dataBinding: 'user.displayName'
      },
      {
        id: 'sport-type',
        type: 'text',
        position: { x: 60, y: 220 },
        size: { width: 630, height: 60 },
        style: {
          fontFamily: 'PingFang SC',
          fontSize: 48,
          color: '#1890ff',
          textAlign: 'left',
          fontWeight: 'bold'
        },
        dataBinding: 'sportRecord.sportTypeName'
      },
      {
        id: 'duration',
        type: 'text',
        position: { x: 60, y: 400 },
        size: { width: 300, height: 120 },
        style: {
          fontFamily: 'Arial',
          fontSize: 64,
          color: '#333333',
          textAlign: 'center',
          fontWeight: 'bold'
        },
        dataBinding: 'sportRecord.duration'
      }
    ]
  },
  
  styles: {
    colors: {
      primary: '#1890ff',
      secondary: '#52c41a',
      textPrimary: '#333333',
      textSecondary: '#666666',
      background: '#ffffff',
      border: '#e8e8e8'
    },
    typography: {
      fontFamily: 'PingFang SC, -apple-system, BlinkMacSystemFont, sans-serif',
      fontSize: {
        small: 24,
        medium: 32,
        large: 48,
        xlarge: 64
      }
    },
    spacing: {
      small: 20,
      medium: 40,
      large: 60
    }
  }
};

// è¿åŠ¨é£æ ¼æ¨¡æ¿
const sportTemplate: ShareTemplate = {
  id: 'sport-001',
  name: 'åŠ¨æ„Ÿæ©™',
  description: 'å……æ»¡æ´»åŠ›çš„è¿åŠ¨ä¸»é¢˜æ¨¡æ¿',
  category: 'sport',
  
  layout: {
    background: {
      type: 'gradient',
      value: {
        type: 'linear',
        colors: ['#ff6b35', '#f7931e'],
        angle: 135
      }
    },
    elements: [
      {
        id: 'sport-icon',
        type: 'icon',
        position: { x: 325, y: 200 },
        size: { width: 100, height: 100 },
        style: {
          color: '#ffffff',
          fontSize: 80
        },
        dataBinding: 'sportRecord.icon'
      }
    ]
  }
};
```

### ä¸»é¢˜è‰²å½©ç®¡ç†
```typescript
// è‰²å½©æ–¹æ¡ˆç®¡ç†å™¨
class ColorSchemeManager {
  private schemes = new Map<string, ColorScheme>();
  
  // é¢„è®¾è‰²å½©æ–¹æ¡ˆ
  private presetSchemes: Record<string, ColorScheme> = {
    'default': {
      primary: '#1890ff',
      secondary: '#52c41a',
      accent: '#faad14',
      background: '#ffffff',
      surface: '#f5f5f5',
      textPrimary: '#333333',
      textSecondary: '#666666',
      textTertiary: '#999999',
      border: '#e8e8e8',
      divider: '#f0f0f0'
    },
    'sport': {
      primary: '#ff6b35',
      secondary: '#f7931e',
      accent: '#ffcc02',
      background: 'linear-gradient(135deg, #ff6b35, #f7931e)',
      textPrimary: '#ffffff',
      textSecondary: '#f0f0f0'
    },
    'business': {
      primary: '#2c3e50',
      secondary: '#3498db',
      accent: '#e74c3c',
      background: '#ffffff',
      textPrimary: '#2c3e50',
      textSecondary: '#7f8c8d'
    },
    'cute': {
      primary: '#ff6b9d',
      secondary: '#c44569',
      accent: '#f8b500',
      background: '#fff5f5',
      textPrimary: '#2d3436',
      textSecondary: '#636e72'
    }
  };
  
  // åŠ¨æ€ç”Ÿæˆè‰²å½©æ–¹æ¡ˆ
  generateScheme(baseColor: string): ColorScheme {
    const hsl = this.hexToHsl(baseColor);
    
    return {
      primary: baseColor,
      secondary: this.hslToHex(hsl.h, hsl.s, Math.min(hsl.l + 0.1, 1)),
      accent: this.hslToHex((hsl.h + 60) % 360, hsl.s, hsl.l),
      background: '#ffffff',
      textPrimary: this.getContrastColor(baseColor),
      textSecondary: this.hslToHex(hsl.h, hsl.s * 0.7, hsl.l * 0.7)
    };
  }
  
  // è·å–å¯¹æ¯”è‰²
  private getContrastColor(hexColor: string): string {
    const rgb = this.hexToRgb(hexColor);
    const brightness = (rgb.r * 299 + rgb.g * 587 + rgb.b * 114) / 1000;
    return brightness > 128 ? '#000000' : '#ffffff';
  }
}
```

### å­—ä½“å›¾æ ‡ç³»ç»Ÿ
```typescript
// å›¾æ ‡å­—ä½“ç®¡ç†å™¨
class IconFontManager {
  private iconMap = new Map<string, string>();
  
  constructor() {
    this.initializeIconMap();
  }
  
  private initializeIconMap(): void {
    // è¿åŠ¨ç±»å‹å›¾æ ‡æ˜ å°„
    this.iconMap.set('running', 'ğŸƒâ€â™‚ï¸');
    this.iconMap.set('cycling', 'ğŸš´â€â™‚ï¸');
    this.iconMap.set('swimming', 'ğŸŠâ€â™‚ï¸');
    this.iconMap.set('walking', 'ğŸš¶â€â™‚ï¸');
    this.iconMap.set('fitness', 'ğŸ’ª');
    this.iconMap.set('yoga', 'ğŸ§˜â€â™€ï¸');
    this.iconMap.set('basketball', 'â›¹ï¸â€â™‚ï¸');
    this.iconMap.set('football', 'âš½');
    
    // æ•°æ®å›¾æ ‡
    this.iconMap.set('duration', 'â±ï¸');
    this.iconMap.set('distance', 'ğŸ“');
    this.iconMap.set('calories', 'ğŸ”¥');
    this.iconMap.set('heart-rate', 'â¤ï¸');
    this.iconMap.set('steps', 'ğŸ‘Ÿ');
  }
  
  getIcon(key: string): string {
    return this.iconMap.get(key) || 'â“';
  }
  
  // è·å–è¿åŠ¨ç±»å‹å›¾æ ‡
  getSportIcon(sportType: string): string {
    const iconMap: Record<string, string> = {
      'running': 'ğŸƒâ€â™‚ï¸',
      'cycling': 'ğŸš´â€â™‚ï¸',
      'swimming': 'ğŸŠâ€â™‚ï¸',
      'walking': 'ğŸš¶â€â™‚ï¸',
      'fitness': 'ğŸ’ª',
      'yoga': 'ğŸ§˜â€â™€ï¸',
      'basketball': 'â›¹ï¸â€â™‚ï¸',
      'football': 'âš½',
      'tennis': 'ğŸ¾',
      'badminton': 'ğŸ¸',
      'volleyball': 'ğŸ',
      'climbing': 'ğŸ§—â€â™‚ï¸',
      'skiing': 'â›·ï¸',
      'skating': 'â›¸ï¸'
    };
    
    return iconMap[sportType] || 'ğŸƒâ€â™‚ï¸';
  }
}
```

### æ¨¡æ¿æ¸²æŸ“å¼•æ“
```typescript
// æ¨¡æ¿æ¸²æŸ“å¼•æ“
class TemplateRenderer {
  private canvas: HTMLCanvasElement;
  private ctx: CanvasRenderingContext2D;
  
  constructor(canvas: HTMLCanvasElement) {
    this.canvas = canvas;
    this.ctx = canvas.getContext('2d')!;
  }
  
  async renderTemplate(
    template: ShareTemplate,
    data: ShareData,
    options?: RenderOptions
  ): Promise<string> {
    // è®¾ç½®ç”»å¸ƒå°ºå¯¸
    this.canvas.width = template.layout.width * 2;
    this.canvas.height = template.layout.height * 2;
    this.ctx.scale(2, 2);
    
    // æ¸²æŸ“èƒŒæ™¯
    await this.renderBackground(template.layout.background);
    
    // æ¸²æŸ“å„ä¸ªå…ƒç´ 
    for (const element of template.layout.elements) {
      await this.renderElement(element, data, template.styles);
    }
    
    // åº”ç”¨ç‰¹æ•ˆ
    if (options?.effects) {
      this.applyEffects(options.effects);
    }
    
    // å¯¼å‡ºå›¾ç‰‡
    return this.canvas.toDataURL('image/png', options?.quality || 0.9);
  }
  
  private async renderElement(
    element: ElementConfig,
    data: ShareData,
    styles: StyleConfig
  ): Promise<void> {
    // æ£€æŸ¥æ¡ä»¶æ¸²æŸ“
    if (element.conditions && !this.checkConditions(element.conditions, data)) {
      return;
    }
    
    // è·å–ç»‘å®šæ•°æ®
    const elementData = element.dataBinding 
      ? this.getDataByPath(data, element.dataBinding)
      : null;
    
    // æ ¹æ®å…ƒç´ ç±»å‹æ¸²æŸ“
    switch (element.type) {
      case 'text':
        await this.renderTextElement(element, elementData, styles);
        break;
      case 'image':
        await this.renderImageElement(element, elementData, styles);
        break;
      case 'shape':
        this.renderShapeElement(element, styles);
        break;
      case 'icon':
        await this.renderIconElement(element, elementData, styles);
        break;
    }
  }
  
  private async renderTextElement(
    element: ElementConfig,
    data: any,
    styles: StyleConfig
  ): Promise<void> {
    const { x, y, width, height } = element.position;
    const style = element.style;
    
    // è®¾ç½®æ–‡å­—æ ·å¼
    this.ctx.font = `${style.fontWeight || 'normal'} ${style.fontSize}px ${style.fontFamily}`;
    this.ctx.fillStyle = style.color;
    this.ctx.textAlign = style.textAlign || 'left';
    this.ctx.textBaseline = style.textBaseline || 'middle';
    
    // å¤„ç†æ–‡å­—å†…å®¹
    const text = this.processTextContent(data, element.format);
    
    // æ–‡å­—æ¢è¡Œå¤„ç†
    if (style.multiline) {
      this.renderMultilineText(text, x, y, width, height, style);
    } else {
      this.ctx.fillText(text, x + width / 2, y + height / 2);
    }
  }
}
```

### æ¨¡æ¿ç¼“å­˜å’Œæ€§èƒ½ä¼˜åŒ–
```typescript
// æ¨¡æ¿ç¼“å­˜ç®¡ç†å™¨
class TemplateCacheManager {
  private templateCache = new Map<string, CachedTemplate>();
  private renderCache = new Map<string, string>();
  
  // æ¨¡æ¿ç¼“å­˜
  cacheTemplate(templateId: string, template: ShareTemplate): void {
    this.templateCache.set(templateId, {
      template,
      timestamp: Date.now(),
      accessCount: 0
    });
  }
  
  // è·å–ç¼“å­˜çš„æ¨¡æ¿
  getCachedTemplate(templateId: string): ShareTemplate | null {
    const cached = this.templateCache.get(templateId);
    if (cached) {
      cached.accessCount++;
      return cached.template;
    }
    return null;
  }
  
  // ç¼“å­˜æ¸²æŸ“ç»“æœ
  cacheRenderResult(key: string, dataUrl: string): void {
    this.renderCache.set(key, dataUrl);
    
    // é™åˆ¶ç¼“å­˜å¤§å°
    if (this.renderCache.size > 100) {
      const firstKey = this.renderCache.keys().next().value;
      this.renderCache.delete(firstKey);
    }
  }
  
  // æ¸…ç†è¿‡æœŸç¼“å­˜
  cleanup(): void {
    const now = Date.now();
    const maxAge = 24 * 60 * 60 * 1000; // 24å°æ—¶
    
    for (const [key, cached] of this.templateCache.entries()) {
      if (now - cached.timestamp > maxAge) {
        this.templateCache.delete(key);
      }
    }
  }
}
```

## Dependencies
- ä¾èµ–ä»»åŠ¡011ï¼ˆCanvaså›¾ç‰‡ç”Ÿæˆï¼‰å®Œæˆ

## Effort Estimate
- **Size**: L (å¤§)
- **Estimated Hours**: 14-18 å°æ—¶

## Definition of Done
- [ ] æ¨¡æ¿é…ç½®ç³»ç»Ÿè®¾è®¡å®Œæˆï¼Œæ”¯æŒçµæ´»çš„JSONæ ¼å¼å®šä¹‰
- [ ] è‡³å°‘4ç§é¢„è®¾æ¨¡æ¿å®ç°ï¼ˆç®€çº¦ã€è¿åŠ¨ã€å•†åŠ¡ã€å¯çˆ±é£æ ¼ï¼‰
- [ ] ä¸»é¢˜è‰²å½©ç®¡ç†ç³»ç»Ÿå®Œæˆï¼Œæ”¯æŒåŠ¨æ€è‰²å½©æ–¹æ¡ˆç”Ÿæˆ
- [ ] å­—ä½“å›¾æ ‡ç³»ç»Ÿé›†æˆï¼Œæ”¯æŒä¸°å¯Œçš„å›¾æ ‡å’Œå­—ä½“é€‰æ‹©
- [ ] æ¨¡æ¿å‚æ•°åŒ–é…ç½®åŠŸèƒ½å®Œå–„ï¼Œæ”¯æŒåŠ¨æ€æ•°æ®ç»‘å®š
- [ ] å“åº”å¼å¸ƒå±€é€‚é…å®Œæˆï¼Œæ”¯æŒä¸åŒå°ºå¯¸å’Œæ¯”ä¾‹çš„åˆ†äº«å›¾ç‰‡
- [ ] æ¨¡æ¿é¢„è§ˆåŠŸèƒ½å®ç°ï¼Œå¯ä»¥å®æ—¶é¢„è§ˆæ¨¡æ¿æ•ˆæœ
- [ ] ç”¨æˆ·è‡ªå®šä¹‰æ¨¡æ¿åŠŸèƒ½å®Œæˆï¼Œæ”¯æŒä¿å­˜å’ŒåŠ è½½ä¸ªäººæ¨¡æ¿
- [ ] æ¨¡æ¿ç¼“å­˜æœºåˆ¶å®æ–½ï¼Œæ˜¾è‘—æé«˜æ¨¡æ¿åŠ è½½å’Œæ¸²æŸ“æ€§èƒ½
- [ ] A/Bæµ‹è¯•æ¡†æ¶é›†æˆï¼Œæ”¯æŒæ¨¡æ¿æ•ˆæœå¯¹æ¯”åˆ†æ
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡è¾¾åˆ°80%ä»¥ä¸Šï¼Œæ ¸å¿ƒåŠŸèƒ½å……åˆ†æµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡ï¼Œæ¨¡æ¿æ¸²æŸ“é€Ÿåº¦æ»¡è¶³ç”¨æˆ·ä½“éªŒè¦æ±‚
- [ ] ä»£ç å®¡æŸ¥å®Œæˆï¼Œç¬¦åˆä»£ç è´¨é‡å’Œè®¾è®¡æœ€ä½³å®è·µ
- [ ] æ¨¡æ¿è®¾è®¡æ–‡æ¡£å’Œä½¿ç”¨æŒ‡å—ç¼–å†™å®Œæ•´ï¼ŒåŒ…å«è®¾è®¡è§„èŒƒå’Œç¤ºä¾‹

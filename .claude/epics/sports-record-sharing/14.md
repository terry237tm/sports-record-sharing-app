---
name: 分享模板设计
status: open
created: 2025-09-09T09:19:22Z
updated: 2025-09-10T06:15:48Z
github: https://github.com/terry237tm/sports-record-sharing-app/issues/14
depends_on: [011]
parallel: false
conflicts_with: []
---

# 分享模板设计

## Description
设计多种精美的运动记录分享模板，提供不同风格和场景的图片模板选择。包括模板配置系统、样式参数化、主题色彩管理、字体图标系统等，确保生成的分享图片具有专业的设计感和个性化特色。

## Acceptance Criteria
- [ ] 模板配置系统设计完成，支持JSON格式模板定义
- [ ] 多种预设模板实现，包含简约、运动、商务、可爱等风格
- [ ] 主题色彩管理系统，支持自定义配色方案
- [ ] 字体和图标系统集成，支持多种字体和图标库
- [ ] 模板参数化配置，支持动态内容替换
- [ ] 响应式布局适配，支持不同尺寸比例的分享图片
- [ ] 模板预览功能，实时预览模板效果
- [ ] 用户自定义模板功能，支持保存个人模板配置
- [ ] 模板缓存机制，提高模板加载性能
- [ ] A/B测试支持，支持不同模板的效果对比

## Technical Details
### 模板配置架构
```typescript
// 模板配置接口
interface ShareTemplate {
  id: string;
  name: string;
  description: string;
  category: 'minimal' | 'sport' | 'business' | 'cute' | 'custom';
  version: string;
  createdAt: Date;
  updatedAt: Date;
  
  // 布局配置
  layout: {
    width: number;
    height: number;
    background: BackgroundConfig;
    elements: ElementConfig[];
  };
  
  // 样式配置
  styles: {
    colors: ColorScheme;
    typography: TypographyConfig;
    spacing: SpacingConfig;
    effects: EffectConfig;
  };
  
  // 数据绑定
  dataBindings: DataBindingConfig[];
}

// 背景配置
interface BackgroundConfig {
  type: 'color' | 'gradient' | 'image' | 'pattern';
  value: string | GradientConfig | ImageConfig;
  opacity?: number;
  overlay?: OverlayConfig;
}

// 元素配置
interface ElementConfig {
  id: string;
  type: 'text' | 'image' | 'shape' | 'icon';
  position: PositionConfig;
  size: SizeConfig;
  style: ElementStyleConfig;
  dataBinding?: string;
  conditions?: ConditionConfig[];
}
```

### 预设模板实现
```typescript
// 简约风格模板
const minimalTemplate: ShareTemplate = {
  id: 'minimal-001',
  name: '简约白',
  description: '简洁大气的白色主题模板',
  category: 'minimal',
  version: '1.0.0',
  
  layout: {
    width: 750,
    height: 1334,
    background: {
      type: 'color',
      value: '#ffffff'
    },
    elements: [
      {
        id: 'user-info',
        type: 'text',
        position: { x: 60, y: 120 },
        size: { width: 630, height: 80 },
        style: {
          fontFamily: 'PingFang SC',
          fontSize: 32,
          color: '#333333',
          textAlign: 'left',
          fontWeight: 'normal'
        },
        dataBinding: 'user.displayName'
      },
      {
        id: 'sport-type',
        type: 'text',
        position: { x: 60, y: 220 },
        size: { width: 630, height: 60 },
        style: {
          fontFamily: 'PingFang SC',
          fontSize: 48,
          color: '#1890ff',
          textAlign: 'left',
          fontWeight: 'bold'
        },
        dataBinding: 'sportRecord.sportTypeName'
      },
      {
        id: 'duration',
        type: 'text',
        position: { x: 60, y: 400 },
        size: { width: 300, height: 120 },
        style: {
          fontFamily: 'Arial',
          fontSize: 64,
          color: '#333333',
          textAlign: 'center',
          fontWeight: 'bold'
        },
        dataBinding: 'sportRecord.duration'
      }
    ]
  },
  
  styles: {
    colors: {
      primary: '#1890ff',
      secondary: '#52c41a',
      textPrimary: '#333333',
      textSecondary: '#666666',
      background: '#ffffff',
      border: '#e8e8e8'
    },
    typography: {
      fontFamily: 'PingFang SC, -apple-system, BlinkMacSystemFont, sans-serif',
      fontSize: {
        small: 24,
        medium: 32,
        large: 48,
        xlarge: 64
      }
    },
    spacing: {
      small: 20,
      medium: 40,
      large: 60
    }
  }
};

// 运动风格模板
const sportTemplate: ShareTemplate = {
  id: 'sport-001',
  name: '动感橙',
  description: '充满活力的运动主题模板',
  category: 'sport',
  
  layout: {
    background: {
      type: 'gradient',
      value: {
        type: 'linear',
        colors: ['#ff6b35', '#f7931e'],
        angle: 135
      }
    },
    elements: [
      {
        id: 'sport-icon',
        type: 'icon',
        position: { x: 325, y: 200 },
        size: { width: 100, height: 100 },
        style: {
          color: '#ffffff',
          fontSize: 80
        },
        dataBinding: 'sportRecord.icon'
      }
    ]
  }
};
```

### 主题色彩管理
```typescript
// 色彩方案管理器
class ColorSchemeManager {
  private schemes = new Map<string, ColorScheme>();
  
  // 预设色彩方案
  private presetSchemes: Record<string, ColorScheme> = {
    'default': {
      primary: '#1890ff',
      secondary: '#52c41a',
      accent: '#faad14',
      background: '#ffffff',
      surface: '#f5f5f5',
      textPrimary: '#333333',
      textSecondary: '#666666',
      textTertiary: '#999999',
      border: '#e8e8e8',
      divider: '#f0f0f0'
    },
    'sport': {
      primary: '#ff6b35',
      secondary: '#f7931e',
      accent: '#ffcc02',
      background: 'linear-gradient(135deg, #ff6b35, #f7931e)',
      textPrimary: '#ffffff',
      textSecondary: '#f0f0f0'
    },
    'business': {
      primary: '#2c3e50',
      secondary: '#3498db',
      accent: '#e74c3c',
      background: '#ffffff',
      textPrimary: '#2c3e50',
      textSecondary: '#7f8c8d'
    },
    'cute': {
      primary: '#ff6b9d',
      secondary: '#c44569',
      accent: '#f8b500',
      background: '#fff5f5',
      textPrimary: '#2d3436',
      textSecondary: '#636e72'
    }
  };
  
  // 动态生成色彩方案
  generateScheme(baseColor: string): ColorScheme {
    const hsl = this.hexToHsl(baseColor);
    
    return {
      primary: baseColor,
      secondary: this.hslToHex(hsl.h, hsl.s, Math.min(hsl.l + 0.1, 1)),
      accent: this.hslToHex((hsl.h + 60) % 360, hsl.s, hsl.l),
      background: '#ffffff',
      textPrimary: this.getContrastColor(baseColor),
      textSecondary: this.hslToHex(hsl.h, hsl.s * 0.7, hsl.l * 0.7)
    };
  }
  
  // 获取对比色
  private getContrastColor(hexColor: string): string {
    const rgb = this.hexToRgb(hexColor);
    const brightness = (rgb.r * 299 + rgb.g * 587 + rgb.b * 114) / 1000;
    return brightness > 128 ? '#000000' : '#ffffff';
  }
}
```

### 字体图标系统
```typescript
// 图标字体管理器
class IconFontManager {
  private iconMap = new Map<string, string>();
  
  constructor() {
    this.initializeIconMap();
  }
  
  private initializeIconMap(): void {
    // 运动类型图标映射
    this.iconMap.set('running', '🏃‍♂️');
    this.iconMap.set('cycling', '🚴‍♂️');
    this.iconMap.set('swimming', '🏊‍♂️');
    this.iconMap.set('walking', '🚶‍♂️');
    this.iconMap.set('fitness', '💪');
    this.iconMap.set('yoga', '🧘‍♀️');
    this.iconMap.set('basketball', '⛹️‍♂️');
    this.iconMap.set('football', '⚽');
    
    // 数据图标
    this.iconMap.set('duration', '⏱️');
    this.iconMap.set('distance', '📍');
    this.iconMap.set('calories', '🔥');
    this.iconMap.set('heart-rate', '❤️');
    this.iconMap.set('steps', '👟');
  }
  
  getIcon(key: string): string {
    return this.iconMap.get(key) || '❓';
  }
  
  // 获取运动类型图标
  getSportIcon(sportType: string): string {
    const iconMap: Record<string, string> = {
      'running': '🏃‍♂️',
      'cycling': '🚴‍♂️',
      'swimming': '🏊‍♂️',
      'walking': '🚶‍♂️',
      'fitness': '💪',
      'yoga': '🧘‍♀️',
      'basketball': '⛹️‍♂️',
      'football': '⚽',
      'tennis': '🎾',
      'badminton': '🏸',
      'volleyball': '🏐',
      'climbing': '🧗‍♂️',
      'skiing': '⛷️',
      'skating': '⛸️'
    };
    
    return iconMap[sportType] || '🏃‍♂️';
  }
}
```

### 模板渲染引擎
```typescript
// 模板渲染引擎
class TemplateRenderer {
  private canvas: HTMLCanvasElement;
  private ctx: CanvasRenderingContext2D;
  
  constructor(canvas: HTMLCanvasElement) {
    this.canvas = canvas;
    this.ctx = canvas.getContext('2d')!;
  }
  
  async renderTemplate(
    template: ShareTemplate,
    data: ShareData,
    options?: RenderOptions
  ): Promise<string> {
    // 设置画布尺寸
    this.canvas.width = template.layout.width * 2;
    this.canvas.height = template.layout.height * 2;
    this.ctx.scale(2, 2);
    
    // 渲染背景
    await this.renderBackground(template.layout.background);
    
    // 渲染各个元素
    for (const element of template.layout.elements) {
      await this.renderElement(element, data, template.styles);
    }
    
    // 应用特效
    if (options?.effects) {
      this.applyEffects(options.effects);
    }
    
    // 导出图片
    return this.canvas.toDataURL('image/png', options?.quality || 0.9);
  }
  
  private async renderElement(
    element: ElementConfig,
    data: ShareData,
    styles: StyleConfig
  ): Promise<void> {
    // 检查条件渲染
    if (element.conditions && !this.checkConditions(element.conditions, data)) {
      return;
    }
    
    // 获取绑定数据
    const elementData = element.dataBinding 
      ? this.getDataByPath(data, element.dataBinding)
      : null;
    
    // 根据元素类型渲染
    switch (element.type) {
      case 'text':
        await this.renderTextElement(element, elementData, styles);
        break;
      case 'image':
        await this.renderImageElement(element, elementData, styles);
        break;
      case 'shape':
        this.renderShapeElement(element, styles);
        break;
      case 'icon':
        await this.renderIconElement(element, elementData, styles);
        break;
    }
  }
  
  private async renderTextElement(
    element: ElementConfig,
    data: any,
    styles: StyleConfig
  ): Promise<void> {
    const { x, y, width, height } = element.position;
    const style = element.style;
    
    // 设置文字样式
    this.ctx.font = `${style.fontWeight || 'normal'} ${style.fontSize}px ${style.fontFamily}`;
    this.ctx.fillStyle = style.color;
    this.ctx.textAlign = style.textAlign || 'left';
    this.ctx.textBaseline = style.textBaseline || 'middle';
    
    // 处理文字内容
    const text = this.processTextContent(data, element.format);
    
    // 文字换行处理
    if (style.multiline) {
      this.renderMultilineText(text, x, y, width, height, style);
    } else {
      this.ctx.fillText(text, x + width / 2, y + height / 2);
    }
  }
}
```

### 模板缓存和性能优化
```typescript
// 模板缓存管理器
class TemplateCacheManager {
  private templateCache = new Map<string, CachedTemplate>();
  private renderCache = new Map<string, string>();
  
  // 模板缓存
  cacheTemplate(templateId: string, template: ShareTemplate): void {
    this.templateCache.set(templateId, {
      template,
      timestamp: Date.now(),
      accessCount: 0
    });
  }
  
  // 获取缓存的模板
  getCachedTemplate(templateId: string): ShareTemplate | null {
    const cached = this.templateCache.get(templateId);
    if (cached) {
      cached.accessCount++;
      return cached.template;
    }
    return null;
  }
  
  // 缓存渲染结果
  cacheRenderResult(key: string, dataUrl: string): void {
    this.renderCache.set(key, dataUrl);
    
    // 限制缓存大小
    if (this.renderCache.size > 100) {
      const firstKey = this.renderCache.keys().next().value;
      this.renderCache.delete(firstKey);
    }
  }
  
  // 清理过期缓存
  cleanup(): void {
    const now = Date.now();
    const maxAge = 24 * 60 * 60 * 1000; // 24小时
    
    for (const [key, cached] of this.templateCache.entries()) {
      if (now - cached.timestamp > maxAge) {
        this.templateCache.delete(key);
      }
    }
  }
}
```

## Dependencies
- 依赖任务011（Canvas图片生成）完成

## Effort Estimate
- **Size**: L (大)
- **Estimated Hours**: 14-18 小时

## Definition of Done
- [ ] 模板配置系统设计完成，支持灵活的JSON格式定义
- [ ] 至少4种预设模板实现（简约、运动、商务、可爱风格）
- [ ] 主题色彩管理系统完成，支持动态色彩方案生成
- [ ] 字体图标系统集成，支持丰富的图标和字体选择
- [ ] 模板参数化配置功能完善，支持动态数据绑定
- [ ] 响应式布局适配完成，支持不同尺寸和比例的分享图片
- [ ] 模板预览功能实现，可以实时预览模板效果
- [ ] 用户自定义模板功能完成，支持保存和加载个人模板
- [ ] 模板缓存机制实施，显著提高模板加载和渲染性能
- [ ] A/B测试框架集成，支持模板效果对比分析
- [ ] 单元测试覆盖率达到80%以上，核心功能充分测试
- [ ] 性能测试通过，模板渲染速度满足用户体验要求
- [ ] 代码审查完成，符合代码质量和设计最佳实践
- [ ] 模板设计文档和使用指南编写完整，包含设计规范和示例

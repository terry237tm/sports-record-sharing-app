# 项目开发规范与要求 - Taro + CloudBase + CCPM 集成版

## 🌏 语言要求
**所有生成的代码注释、文档和描述信息必须使用中文**。这是客户的明确要求，必须严格遵守。**违反此要求将导致项目不合格。**

### 实施要求（必须严格执行）
- ✅ **代码注释必须使用中文** - 包括函数说明、类说明、复杂逻辑解释
- ✅ **文档说明必须使用中文** - 包括 README、API 文档、配置说明
- ✅ **错误信息和提示必须使用中文** - 用户界面显示的所有文本
- ✅ **函数/变量命名应使用有意义的英文名称，但注释说明必须为中文**
- ✅ **Git 提交信息建议使用中文** - 便于团队理解

### 严禁行为
- ❌ 任何英文注释或文档（除非是必要的专业术语）
- ❌ 混合使用中英文注释
- ❌ 仅使用英文变量名而无中文说明

## 📁 日志文件管理

### 日志文件存放规则（绝对要求）
- 🔴 **严禁在项目根目录生成或保留记录解决过程的 Markdown 文件**（如 DEPRECATION_FIXES_SUMMARY.md、process-log.md、debug-notes.md 等）
- 🔴 **所有此类日志必须输出到 `docs/claude-logs/` 目录**
- 🔴 **使用正确的日期前缀和英文文件名**
- 🔴 **必须使用 shell 命令获取当前日期，不能手动假设日期**

### 正确命名格式
```bash
# 获取当前日期（必须使用）
date +%Y-%m-%d

# 正确示例
docs/claude-logs/2025-09-10-pnpm-install-guide.md
docs/claude-logs/2025-09-10-deprecation-fixes.md
docs/claude-logs/2025-09-10-debug-session.md
```

### 创建日志文件的正确流程
```bash
# 1. 首先创建目录（如果不存在）
mkdir -p docs/claude-logs

# 2. 获取当前日期
current_date=$(date +%Y-%m-%d)

# 3. 创建带日期的日志文件
echo "# Debug Log - $(date)" > "docs/claude-logs/${current_date}-debug-notes.md"
```

### 严禁行为
- ❌ 在根目录创建任何日志文件
- ❌ 手动假设日期（如直接写 2025-06-22）
- ❌ 使用中文文件名
- ❌ 混合存放日志文件和源代码

## 🤖 CCPM 集成配置

### 子代理使用规范
**为了优化上下文使用和性能，必须使用指定的子代理：**

1. **file-analyzer 子代理** - 用于读取文件时
   - 专门提取和总结文件中的关键信息
   - 提供简洁、可操作的分析结果
   - 显著减少上下文使用量

2. **code-analyzer 子代理** - 用于搜索代码、分析代码、研究错误或追踪逻辑流时
   - 专业的代码分析和逻辑追踪
   - 漏洞检测和代码质量分析
   - 提供简洁、可操作的分析结果

3. **test-runner 子代理** - 用于运行测试和分析测试结果时
   - 完整的测试输出捕获用于调试
   - 保持主对话清洁和专注
   - 优化上下文使用
   - 正确显示所有问题
   - 无中断的工作流

### 开发哲学

#### 错误处理
- **快速失败** - 关键配置错误立即失败（缺少文本模型）
- **记录并继续** - 可选功能失败时记录并继续（提取模型）
- **优雅降级** - 外部服务不可用时优雅处理
- **用户友好消息** - 通过弹性层提供友好错误信息

#### 测试原则
- 始终使用 test-runner 代理执行测试
- 绝不使用模拟服务
- 在完成当前测试前不进入下一个测试
- 测试失败时先检查测试结构是否正确，再决定是否重构代码库
- 测试应该详细，以便用于调试

#### 语气和行为
- 欢迎批评，指出错误或可能有误的地方
- 如果有更好的方法，请提出建议
- 如果存在相关的标准或约定，请指出
- 保持怀疑态度
- 保持简洁
- 简短的总结可以，但不要给出详细的分解，除非我们正在讨论计划的细节
- 不要奉承，除非特别要求判断，否则不要给予赞扬

## 🧪 TDD 开发模式

### 核心原则（绝对不能违反）
**我们必须严格遵守 TDD（测试驱动开发）开发模式。这是专业开发工程师的基本要求，不是可选的。**

### 严禁行为（零容忍）
- 🔴 **不得通过删除失败的测试文件来实现测试套件通过** - 这是欺骗行为
- 🔴 **不得通过简化测试来欺骗自己相信测试通过** - 这是自欺欺人
- 🔴 **不得忽视或跳过失败的测试** - 这是不负责任的做法
- 🔴 **不得注释掉失败测试** - 这是逃避问题
- 🔴 **不得使用模拟数据掩盖真实问题** - 这是造假行为

### 正确做法（必须遵循）
- ✅ **先写测试，后实现功能** - 严格执行红-绿-重构循环
- ✅ **确保所有测试都真正通过** - 不是表面通过
- ✅ **修复失败的测试，而不是删除它们** - 解决问题的根本原因
- ✅ **保持测试的完整性和有效性** - 测试必须反映真实使用场景
- ✅ **测试必须详细且可用于调试** - 测试是活文档

### TDD 开发流程（严格执行）
1. **🔴 红色**：编写测试用例，确认测试失败
2. **🟢 绿色**：编写最小代码使测试通过
3. **🔵 重构**：优化代码结构，确保测试仍然通过
4. **🔄 重复**：继续下一个功能循环

### 测试质量标准
- 测试必须能够揭示代码缺陷
- 测试必须覆盖边界条件和异常情况
- 测试必须是可维护和可读的
- 测试必须独立于其他测试
- 测试运行必须快速

### 专业工程师的态度
**删除失败测试来"通过"测试套件的行为，相当于医生隐瞒病情来"治愈"病人。这是不专业的，也是不能接受的。**

## 🔧 技术规范

### 代码质量
- 遵循 SOLID 原则
- 保持代码简洁清晰
- 避免过度工程化
- 优先解决当前需求

### 文件组织
- 合理规划文件结构
- 使用描述性命名
- 遵循项目现有约定
- 保持工作空间整洁

### Git 工作流
- 使用功能分支
- 频繁提交，提交信息有意义
- 在风险操作前创建还原点
- 保持干净的提交历史

## ⚠️ 质量控制

### 开发前检查
- [ ] 理解需求
- [ ] 规划实现方案  
- [ ] 识别并行操作机会
- [ ] 评估资源使用情况

### 开发后验证
- [ ] 运行测试套件
- [ ] 执行代码检查（lint）
- [ ] 执行类型检查（typecheck）
- [ ] 验证功能完整性

### 任务管理
- 使用 TodoWrite 工具跟踪复杂任务
- 及时标记任务状态
- 保持任务描述的清晰性
- 定期检査进度

## 🎯 成功标准（必须全部满足）
- ✅ **所有测试真正通过** - 不是删除失败测试的虚假通过
- ✅ **代码符合质量标准** - 遵循 SOLID 原则，无重复代码
- ✅ **文档使用中文** - 所有注释、文档、错误信息都是中文
- ✅ **日志文件正确归档** - 严格使用 `docs/claude-logs/YYYY-MM-DD-description.md` 格式
- ✅ **功能完整实现** - 不简化、不妥协、不部分实现
- ✅ **CCPM 子代理正确使用** - 按要求使用 file-analyzer、code-analyzer、test-runner
- ✅ **TDD 模式严格执行** - 红-绿-重构循环，不欺骗、不逃避

## 📚 CCPM 相关资源
- [CCPM 命令参考](./COMMANDS.md)
- [CCPM 代理说明](./AGENTS.md)
- [CCPM 完整文档](./README.md)
# 运动记录分享小程序 - 产品需求文档 (PRD)

## 1. 产品概述

### 1.1 产品定位
一款基于微信小程序平台的个人运动数据记录与社交分享应用，用户可以通过图文形式记录运动轨迹，生成精美的分享图片，与朋友分享运动成果。

### 1.2 核心价值
- **记录功能**：便捷记录运动数据和轨迹
- **分享体验**：生成精美的分享图片，提升社交传播效果
- **数据管理**：个人运动历史管理和统计
- **社交互动**：基于运动内容的社交分享

### 1.3 目标用户
- 年龄：18-45岁的运动爱好者
- 特征：喜欢记录生活、乐于分享的微信用户
- 场景：跑步、骑行、健身、徒步等各类运动场景

## 2. 功能需求

### 2.1 核心功能模块

#### 2.1.1 运动记录创建
**功能描述**：用户创建运动记录，包括运动数据、图片和位置信息

**功能点**：
- 运动类型选择（跑步、骑行、健身、徒步等）
- 运动数据录入（时长、距离、卡路里）
- 图片上传（最多9张，支持相册选择和相机拍摄）
- 地理位置自动获取和地址解析
- 运动说明文字输入
- 数据验证和错误提示

**输入验证**：
- 内容和图片为必填项
- 运动数据需为有效数值
- 图片数量限制为1-9张

#### 2.1.2 分享图片生成
**功能描述**：基于运动记录生成精美的分享图片

**功能点**：
- Canvas绘制分享图片（750×1334像素）
- 自适应文本换行处理
- 用户信息展示（头像、昵称）
- 运动数据和内容展示
- 图片自动缩放和裁剪
- 保存到相册和微信分享

**技术规格**：
- 画布尺寸：750×1334像素
- 导出质量：2倍清晰度
- 文本最大宽度：630px
- 图片显示尺寸：630×400px

#### 2.1.3 历史记录管理
**功能描述**：查看和管理个人运动历史记录

**功能点**：
- 分页加载历史记录（每页10条）
- 记录详情查看
- 图片预览功能
- 记录删除功能
- 重新分享功能
- 本地数据缓存

**交互设计**：
- 下拉刷新获取最新数据
- 上拉加载更多记录
- 相对时间显示（刚刚、几分钟前等）

#### 2.1.4 快速分享入口
**功能描述**：在首页提供快速分享功能

**功能点**：
- 简化版记录创建
- 快速上传和分享
- 状态实时更新
- 一键分享到社交平台

### 2.2 辅助功能

#### 2.2.1 地理位置服务
**功能描述**：获取用户运动位置信息

**功能点**：
- GPS坐标获取
- 逆地理编码（坐标转地址）
- 位置权限管理
- 降级处理（坐标显示）

#### 2.2.2 图片处理
**功能描述**：图片上传和存储管理

**功能点**：
- 本地图片选择
- 图片压缩处理
- 批量上传云存储
- 上传进度显示
- 失败重试机制

#### 2.2.3 数据同步
**功能描述**：本地数据与云端数据同步

**功能点**：
- 网络状态检测
- 离线数据缓存
- 自动同步机制
- 冲突解决策略

## 3. 技术架构 (Taro + CloudBase 重构版)

### 3.1 前端架构
**技术栈**：Taro + TypeScript + React
- **Taro 3.x**：跨端开发框架，支持微信小程序、H5等多端
- **TypeScript**：类型安全的开发语言
- **React Hooks**：函数式组件和状态管理
- **Redux/MobX**：全局状态管理（可选）

**项目结构设计**（基于功能模块组织）：
```
src/
├── pages/              # 页面组件
│   ├── Home/          # 首页 - 快速分享入口
│   ├── CreateRecord/  # 记录创建页 - 核心功能
│   ├── SharePreview/  # 分享预览页 - Canvas生成
│   ├── History/       # 历史记录展示
│   └── Map/           # 运动轨迹地图
├── components/        # 通用组件
│   ├── ImageUploader/ # 图片上传组件
│   ├── SportForm/     # 运动数据表单
│   ├── ShareCanvas/   # Canvas分享图片生成
│   └── LocationPicker/# 位置选择组件
├── hooks/             # 自定义Hooks
│   ├── useLocation.ts # 地理位置Hook
│   ├── useUpload.ts   # 上传Hook
│   └── useShare.ts    # 分享Hook
├── services/          # 业务服务层
│   ├── api.ts         # API接口封装
│   ├── storage.ts     # 存储服务
│   └── share.ts       # 分享服务
├── types/             # TypeScript类型定义
│   ├── sport.ts       # 运动记录类型
│   ├── user.ts        # 用户类型
│   └── api.ts         # API类型
├── utils/             # 工具函数
│   ├── constants.ts   # 常量定义
│   ├── validators.ts  # 验证函数
│   └── formatters.ts  # 格式化函数
└── store/             # 状态管理
    ├── index.ts       # Store入口
    ├── sportSlice.ts  # 运动记录状态
    └── userSlice.ts   # 用户状态
```

### 3.2 后端架构
**技术栈**：CloudBase MCP Tools + 微信云开发
- **CloudBase MCP Tools**：现代化的云开发工具链
- **云函数**：TypeScript编写的业务逻辑
- **云数据库**：MongoDB数据存储
- **云存储**：文件存储服务
- **云调用**：API接口代理

**云函数架构**（基于业务领域组织）：
```
cloudfunctions/
├── sport/                    # 运动记录相关
│   ├── createSportPost.ts    # 创建运动记录
│   ├── getSportPosts.ts      # 获取运动记录列表
│   ├── deleteSportPost.ts    # 删除运动记录
│   └── updateSportStats.ts   # 更新用户运动统计
├── media/                    # 媒体处理相关
│   ├── uploadImages.ts       # 批量图片上传
│   ├── processImage.ts       # 图片处理
│   └── generateShareImage.ts # 生成分享图片
├── location/                 # 地理位置相关
│   ├── getAddress.ts         # 逆地理编码
│   ├── validateLocation.ts   # 位置验证
│   └── searchNearby.ts       # 附近搜索
├── user/                     # 用户相关
│   ├── getUserProfile.ts     # 获取用户信息
│   ├── updateUserStats.ts    # 更新用户统计
│   └── syncUserData.ts       # 同步用户数据
└── system/                   # 系统相关
    ├── healthCheck.ts        # 健康检查
    ├── initDatabase.ts       # 数据库初始化
    └── cleanup.ts           # 数据清理
```

**MCP Tools 集成**（开发工具链）：
- **类型安全**：TypeScript接口定义和类型检查
- **API文档**：自动生成API文档
- **测试工具**：自动化测试和部署
- **监控告警**：性能监控和错误追踪
- **数据迁移**：数据库版本管理和迁移工具

### 3.3 数据模型

#### 3.3.1 运动记录集合 (sport_posts)
```javascript
{
  _id: ObjectId,           // 记录ID
  content: String,         // 运动说明（必填）
  images: Array,           // 图片fileID数组（必填）
  sportType: String,       // 运动类型
  duration: Number,        // 运动时长（分钟）
  distance: Number,        // 运动距离（公里）
  calories: Number,        // 消耗卡路里
  location: {              // 地理位置
    latitude: Number,      // 纬度
    longitude: Number,     // 经度
    address: String        // 地址描述
  },
  userId: String,          // 用户openid
  userInfo: {              // 用户信息
    nickName: String,      // 用户昵称
    avatarUrl: String      // 头像URL
  },
  timestamp: Number,       // 创建时间戳
  updateTime: Number,      // 更新时间戳
  likes: Number,           // 点赞数（默认0）
  shares: Number,          // 分享数（默认0）
  isPublic: Boolean,       // 是否公开（默认true）
  status: String           // 状态：active、deleted
}
```

#### 3.3.2 用户统计集合 (sport_users)
```javascript
{
  _id: String,             // 用户openid
  totalPosts: Number,      // 总帖子数
  totalDistance: Number,   // 总运动距离
  totalDuration: Number,   // 总运动时长
  createTime: Number,      // 首次创建时间
  updateTime: Number       // 最后更新时间
}
```

## 4. 用户流程

### 4.1 创建运动记录流程
```
开始 → 进入记录页 → 获取地理位置 → 填写运动数据 → 选择图片 → 提交保存
                                ↓
                            数据验证失败 ← 显示错误提示
                                ↓
验证成功 → 上传图片到云存储 → 保存记录到数据库 → 跳转到历史页
```

### 4.2 生成分享图片流程
```
开始 → 获取记录数据 → Canvas绘制图片 → 生成分享图片 → 保存相册/微信分享
                    ↓
                绘制失败 ← 显示错误提示
```

### 4.3 查看历史记录流程
```
开始 → 进入历史页 → 加载用户记录 → 显示记录列表 → 选择记录操作
                                        ↓
                                    查看详情/删除/分享
```

## 5. 性能需求

### 5.1 响应时间要求
- 页面加载时间：< 2秒
- 图片上传时间：< 5秒（单张图片）
- 数据保存时间：< 1秒
- Canvas生成时间：< 3秒

### 5.2 并发处理能力
- 同时在线用户：1000+
- 每秒请求处理：100+
- 图片并发上传：10张

### 5.3 存储容量规划
- 单张图片大小：< 2MB
- 用户存储配额：1GB
- 数据库容量：无限制（云开发）

## 6. 安全需求

### 6.1 数据安全
- 用户数据隔离：基于openid的数据访问控制
- 数据传输加密：HTTPS协议
- 数据备份机制：云端自动备份

### 6.2 权限管理
- 用户授权：地理位置、相册访问权限
- 数据访问：用户只能访问自己的数据
- 操作权限：删除、修改权限验证

### 6.3 内容安全
- 内容审核：敏感词过滤
- 图片安全：违规内容检测
- 用户举报：违规内容处理机制

## 7. 兼容性需求

### 7.1 微信平台兼容性
- 微信版本：7.0+
- 基础库版本：2.20+
- 小程序版本：最新稳定版

### 7.2 设备兼容性
- iOS系统：iOS 10+
- Android系统：Android 5.0+
- 屏幕适配：支持各种屏幕尺寸

### 7.3 网络环境
- 网络类型：WiFi、4G、5G
- 弱网处理：网络超时和重试机制
- 离线支持：本地数据缓存

## 8. 用户体验需求

### 8.1 界面设计
- **设计风格**：简洁、现代、运动风格
- **色彩搭配**：活力橙色为主色调
- **字体规范**：微信标准字体
- **图标风格**：线性图标，保持一致性

### 8.2 交互设计
- **操作流程**：简化操作步骤，减少用户输入
- **反馈机制**：实时状态反馈，操作结果提示
- **错误处理**：友好的错误提示和解决方案
- **加载体验**：加载动画，进度显示

### 8.3 可访问性
- **文字大小**：支持系统字体大小调整
- **颜色对比**：满足无障碍颜色对比要求
- **操作便捷**：支持单手操作

## 9. 运营需求

### 9.1 数据统计
- **用户数据**：新增用户、活跃用户、留存率
- **内容数据**：发布数量、分享数量、互动数据
- **性能数据**：加载时间、错误率、用户反馈

### 9.2 推广支持
- **分享传播**：支持微信好友、朋友圈分享
- **二维码推广**：支持小程序码生成
- **活动支持**：支持运营活动配置

### 9.3 内容管理
- **内容审核**：敏感内容过滤和处理
- **用户管理**：违规用户处理机制
- **数据导出**：支持数据报表导出

## 10. 非功能性需求

### 10.1 可靠性
- **系统稳定性**：99.9%可用性
- **错误恢复**：自动错误恢复机制
- **数据一致性**：保证数据操作的一致性

### 10.2 可维护性
- **代码规范**：统一的代码编写规范
- **文档完整**：完整的开发文档和接口文档
- **监控告警**：系统运行状态监控

### 10.3 可扩展性
- **架构扩展**：支持功能模块扩展
- **性能扩展**：支持用户量增长
- **数据扩展**：支持数据量增长

## 11. 项目约束

### 11.1 技术约束
- **平台限制**：微信小程序平台规范
- **开发框架**：Taro跨端框架 + TypeScript
- **部署环境**：微信云开发环境 + CloudBase MCP Tools
- **架构要求**：模块化、组件化、类型安全

### 11.2 资源约束
- **开发时间**：预计4-6周开发周期
- **团队规模**：2-3人开发团队
- **预算限制**：云开发免费额度内

### 11.3 法规约束
- **隐私保护**：遵守个人信息保护法
- **内容合规**：遵守网络内容管理规定
- **平台规范**：遵守微信小程序平台规范

## 12. 风险分析

### 12.1 技术风险
- **微信政策变化**：平台规则调整影响
- **云开发限制**：免费额度使用限制
- **性能瓶颈**：高并发下的性能问题

### 12.2 运营风险
- **用户增长**：用户量增长带来的挑战
- **内容质量**：用户生成内容的质量控制
- **竞争压力**：同类产品的竞争

### 12.3 应对措施
- **多平台准备**：考虑其他平台扩展
- **架构优化**：持续优化系统架构
- **运营策略**：制定完善的运营策略

---

**本PRD文档专注于程序设计思路与业务逻辑，为使用 Taro + CloudBase MCP Tools + TypeScript 重构项目提供清晰的技术指导，避免原微信小程序框架的具体实现细节影响新架构的设计决策。**